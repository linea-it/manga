<html>

<head>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>

<body>
    <p>
        Here's a simple Plotly plot -
        <a href="https://bit.ly/1Or9igj">plotly.js documentation</a>
    </p>

    <!-- Plots go in blank <div> elements. 
            You can size them in the plot layout,
            or give the div a size as shown here.
        -->
    <style>
        .flex-container {
            display: flex;
            background-color: DodgerBlue;
        }

        .flex-container>div {
            background-color: #f1f1f1;
            margin: 10px;
            padding: 20px;
            font-size: 30px;
        }
    </style>

    <div class="flex-container">
        <div id="image" style="width:600px;height:600px;"></div>
        <div id="flux" style="width:860px;height:480px;"></div>
    </div>

    <script>
        // Plot Image Heatmap
        fetch("http://localhost:8000/api/image_heatmap?megacube=manga-8138-6101-MEGA.fits&hud=xyy").then(function (response) {
            return response.json();
        }).then(function (data) {
            console.log(data);

            // Carregar outro HUD para fazer o contours
            fetch("http://localhost:8000/api/image_heatmap?megacube=manga-8138-6101-MEGA.fits&hud=mio").then(function (response) {
                return response.json();
            }).then(function (contours) {
                console.log(contours);


                // Desenhar o Plot
                plotImage = document.getElementById('image');

                Plotly.plot(plotImage, [
                    {
                        z: data.z,
                        name: 'Image',
                        type: 'heatmap',
                        colorscale: "Viridis",
                    },
                    {
                        z: contours.z,
                        type: 'contour',
                        contours: {
                            coloring: 'none'
                        },
                        line: {
                            color: 'white',
                            smoothing: 0.85
                        },
                    },
                ], {
                    margin: 15,
                    title: data.title,
                    yaxis: {
                        scaleanchor: 'x'
                    }
                }, {
                    showSendToCloud: true
                });
            });
        }).catch(function () {
            console.log("Booo");
        });

        // Plot Fluxo
        fetch("http://localhost:8000/api/flux_by_position?megacube=manga-8138-6101-MEGA.fits&x=25&y=26").then(function (response) {
            return response.json();
        }).then(function (data) {
            console.log(data);

            plotFlux = document.getElementById('flux');

            Plotly.plot(plotFlux, [
                {
                    x: data.lamb,
                    y: data.flux,
                    name: 'Flux',
                },
                {
                    x: data.lamb,
                    y: data.synt,
                    name: 'Synt',
                    // line: {
                    //     color: 'rgb(219, 64, 82)'
                    // }
                },
            ], {
                margin: 15,
                title: 'TITLE',
            }, {
                showSendToCloud: true
            });

        }).catch(function () {
            console.log("Booo");
        });
    </script>

</body>

</html>